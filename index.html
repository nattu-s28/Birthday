<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Birthday Surprise</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Sacramento&family=Poppins:wght@300;400;600&family=Playfair+Display:wght@700;900&display=swap"
        rel="stylesheet">

    <style>
        /* 
         * ========================================
         * COSMIC THEME - Mobile First Design
         * ========================================
         */
        :root {
            --bg-dark: #0a0014;
            --bg-violet: #1a0033;
            --neon-pink: #ff1493;
            --neon-violet: #9d4edd;
            --text-silver: #e0e0e0;
            --text-pink: #ffc0cb;
            --text-gold: #ffd700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at 50% 50%, var(--bg-violet) 0%, var(--bg-dark) 100%);
            color: var(--text-silver);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated starfield background */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent),
                radial-gradient(1px 1px at 33% 80%, white, transparent);
            background-size: 200% 200%;
            animation: twinkle 8s ease-in-out infinite;
            opacity: 0.6;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.6;
            }

            50% {
                opacity: 0.3;
            }
        }

        /* 
         * ========================================
         * STAGE CONTAINER
         * ========================================
         */
        .stage {
            display: none;
            text-align: center;
            padding: 20px;
            max-width: 90%;
            width: 600px;
            animation: fadeIn 0.8s ease-out;
            position: relative;
            z-index: 1;
        }

        .stage.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 
         * ========================================
         * STAGE 1: COUNTDOWN
         * ========================================
         */
        #countdown-stage h1 {
            font-family: 'Sacramento', cursive;
            font-size: 2rem;
            color: var(--text-pink);
            margin-bottom: 30px;
            letter-spacing: 2px;
        }

        #countdown-timer {
            font-size: 3.5rem;
            /* Reduced for full date string */
            font-weight: 700;
            color: #fff;
            display: inline-block;
            animation: pulse 1.5s ease-in-out infinite;
            text-shadow:
                0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink),
                0 0 30px var(--neon-pink), 0 0 40px var(--neon-violet),
                0 0 70px var(--neon-violet), 0 0 80px var(--neon-violet),
                0 0 100px var(--neon-violet);
            white-space: nowrap;
        }

        .countdown-label {
            display: block;
            font-size: 1rem;
            color: var(--text-gold);
            margin-top: 10px;
            letter-spacing: 2px;
        }



        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                text-shadow:
                    0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink),
                    0 0 30px var(--neon-pink), 0 0 40px var(--neon-violet),
                    0 0 70px var(--neon-violet), 0 0 80px var(--neon-violet),
                    0 0 100px var(--neon-violet);
            }

            50% {
                transform: scale(1.05);
                text-shadow:
                    0 0 15px var(--neon-violet), 0 0 25px var(--neon-violet),
                    0 0 35px var(--neon-violet), 0 0 45px var(--neon-pink),
                    0 0 75px var(--neon-pink), 0 0 85px var(--neon-pink),
                    0 0 110px var(--neon-pink);
            }
        }

        /* 
         * ========================================
         * STAGE 2: GREETING
         * ========================================
         */
        #greeting-stage img {
            width: 150px;
            height: auto;
            margin-bottom: 30px;
            animation: bounceIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 20px rgba(255, 105, 180, 0.5));
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            60% {
                transform: scale(1.15);
                opacity: 1;
            }

            100% {
                transform: scale(1);
            }
        }

        #greeting-text {
            font-family: 'Sacramento', cursive;
            font-size: 2.5rem;
            line-height: 1.4;
            color: var(--neon-pink);
            margin-bottom: 15px;
            min-height: 3.5rem;
            text-shadow: 0 0 10px rgba(255, 20, 147, 0.8), 0 0 20px rgba(255, 20, 147, 0.5);
        }

        #greeting-text::after {
            content: '|';
            animation: blink 0.8s infinite;
            margin-left: 3px;
        }

        #greeting-text.typing-complete::after {
            content: '';
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        #greeting-stage p {
            font-size: 1rem;
            color: var(--text-silver);
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.5s forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 
         * ========================================
         * STAGE 3: INTERACTIVE CAKE
         * ========================================
         */
        #cake-stage {
            position: relative;
        }

        #cake-stage img {
            width: 250px;
            height: auto;
            margin: 0 auto 20px auto;
            display: block;
            filter: drop-shadow(0 0 15px rgba(255, 105, 180, 0.3));
        }

        #cake-message {
            font-family: 'Sacramento', cursive;
            font-size: 2rem;
            color: var(--neon-pink);
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 20, 147, 0.6);
            min-height: 2.5rem;
        }

        /* 
         * ========================================
         * NEW PARTY DECORATION SYSTEM
         * ========================================
         */
        .party-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 99;
            overflow: hidden;
        }

        /* Bunting Flags */
        .bunting-row {
            position: absolute;
            display: flex;
            width: 150%;
            height: 60px;
            top: -100px;
            /* Start off-screen */
            transition: transform 0.8s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .bunting-row.show {
            transform: translateY(100px) rotate(var(--angle));
        }

        .bunting-flag {
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 50px solid var(--color);
            margin: 0 5px;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.1));
        }

        /* Confetti Blast */
        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: var(--color);
            opacity: 0;
        }

        .confetti.falling {
            animation: blastFall var(--duration) ease-out forwards;
        }

        @keyframes blastFall {
            0% {
                opacity: 1;
                transform: translate(var(--start-x), var(--start-y)) rotate(0deg) scale(0.5);
            }

            20% {
                opacity: 1;
                transform: translate(var(--mid-x), var(--mid-y)) rotate(180deg) scale(1.2);
            }

            100% {
                opacity: 0;
                transform: translate(var(--end-x), var(--end-y)) rotate(720deg) scale(1);
            }
        }

        /* Ground Confetti Layer */
        .ground-confetti {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            opacity: 0;
            transition: opacity 1.5s ease-in;
            z-index: 1;
            background-repeat: repeat-x;
            background-position: bottom;
        }

        .ground-confetti.show {
            opacity: 1;
        }

        /* Realistic Flame */
        .flame {
            position: absolute;
            width: 20px;
            height: 30px;
            background: radial-gradient(ellipse at bottom, #fff 0%, #ffeb3b 40%, #ff9800 100%);
            border-radius: 50% 50% 20% 20%;
            transform-origin: center bottom;
            animation: flicker 0.1s infinite alternate, glow 1.5s ease-in-out infinite alternate;
            box-shadow:
                0 0 20px #ffeb3b,
                0 0 40px #ff9800,
                0 0 60px #ff5722;
            z-index: 5;
            filter: blur(1px);
        }

        @keyframes flicker {
            0% {
                transform: translateX(-50%) scale(1) rotate(-2deg);
                opacity: 0.9;
            }

            100% {
                transform: translateX(-50%) scale(1.1) rotate(2deg);
                opacity: 1;
            }
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 20px #ffeb3b, 0 0 40px #ff9800;
            }

            100% {
                box-shadow: 0 0 30px #ffeb3b, 0 0 60px #ff9800, 0 0 80px #ff5722;
            }
        }

        .flame.extinguished {
            animation: extinguish 0.5s ease-out forwards;
        }

        @keyframes extinguish {
            0% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateX(-50%) scale(0.2) translateY(-20px);
                opacity: 0;
            }
        }

        /* Balloon Animation */
        /* Balloon Group Container - Moves as one unit */
        .balloon-group {
            position: absolute;
            /* Start well below screen */
            bottom: -50vh;
            /* Left will be set by JS logic */

            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
            cursor: pointer;
            width: 100px;

            transform-origin: center bottom;
            /* Center balloon at assigned position + keep small size */
            transform: translateX(-50%) scale(0.7);

            /* Smooth transitions:
               - bottom: controls the rise duration (set to 15s for VERY SLOW)
               - left: allows for gentle horizontal drifting if needed
            */
            transition: bottom 15s cubic-bezier(0.2, 0.8, 0.2, 1), transform 0.3s ease;
            will-change: bottom;
        }

        /* The Balloon Element */
        .balloon {
            width: 90px;
            height: 110px;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: relative;
            box-shadow: inset -5px -5px 15px rgba(0, 0, 0, 0.1), 2px 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* Balloon Shine */
        .balloon::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 20%;
            width: 12px;
            height: 25px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: rotate(45deg);
        }

        /* Balloon Knot */
        .balloon::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 8px solid inherit;
            /* Takes balloon color */
        }

        /* String */
        .balloon-string {
            width: 1.5px;
            height: 50px;
            /* Slight increase for elegance */
            background: rgba(255, 255, 255, 0.7);
            margin-top: -2px;
        }

        /* The Character Image */
        .balloon-group img {
            width: 100px;
            height: auto;
            object-fit: contain;
            margin-top: -3px;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        /* Gentle Hover Animation (Restricted) */
        .balloon-group.floating {
            animation: gentleBob 4s ease-in-out infinite alternate;
        }

        @keyframes gentleBob {
            0% {
                transform: translateX(-50%) scale(0.7) translateY(0);
            }

            100% {
                transform: translateX(-50%) scale(0.7) translateY(-10px);
            }
        }

        /* Pop Interaction */
        .balloon.popped {
            animation: pop 0.2s ease-out forwards;
        }

        .balloon-group.popped img {
            opacity: 0;
            transform: translateY(30px) rotate(5deg);
        }

        .balloon-group.popped .balloon-string {
            opacity: 0;
        }

        .advance-wish {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            /* Fixed readable small size */
            font-weight: 900;
            color: var(--neon-pink);
            -webkit-text-stroke: 0.7px black;
            text-shadow: 0 0 5px var(--neon-pink);
            margin: 0;
            /* Margin handled by container */
            letter-spacing: 1px;
            text-align: left;
            /* Text must remain left-aligned for cursor to move right */

            /* Typewriter properties */
            overflow: hidden;
            border-right: 3px solid var(--neon-pink);
            white-space: nowrap;
            width: 0;
            animation:
                typing 4s steps(34, end) 1s forwards,
                blinkCursor 0.75s step-end infinite;
            display: inline-block;
        }

        @keyframes typing {
            from {
                width: 0
            }

            to {
                width: 34ch
            }

            /* Exact character width target */
        }

        @keyframes blinkCursor {

            from,
            to {
                border-color: transparent
            }

            50% {
                border-color: var(--neon-pink)
            }
        }


        /* Container to center the inline-block typewriter */
        .advance-wish-container {
            display: flex;
            justify-content: center;
            width: 100%;
        }



        .balloon.popped {
            animation: pop 0.3s ease-out forwards;
        }

        @keyframes floatIn {
            from {
                transform: translateY(100vh) scale(0.5);
                opacity: 0;
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes floatHover {
            0% {
                transform: translateY(0) rotate(-5deg);
            }

            100% {
                transform: translateY(-20px) rotate(5deg);
            }
        }

        @keyframes pop {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.4);
                opacity: 0.8;
            }

            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        /* Name Reveal Container */
        .name-reveal-container {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 30px;
            flex-wrap: wrap;
            min-height: 60px;
            max-width: 100%;
            padding: 0 10px;
        }

        .surprise-box {
            width: 28px;
            height: 38px;
            border: 2px solid var(--neon-violet);
            border-radius: 6px;
            background: rgba(26, 0, 51, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--text-gold);
            text-shadow: 0 0 5px var(--neon-pink);
            box-shadow: 0 0 10px rgba(157, 78, 221, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .surprise-box.revealed {
            background: var(--neon-pink);
            color: white;
            border-color: white;
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--neon-pink);
        }

        /* Animation for letter appearing */
        .surprise-box span {
            display: inline-block;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            70% {
                transform: scale(1.4);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* 
         * ========================================
         * STAGE 5: GIFT
         * ========================================
         */

        #gift-section {
            text-align: center;
        }

        #gift-section p {
            font-size: 1.2rem;
            color: var(--text-pink);
            margin-bottom: 20px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        #gift-box {
            width: 200px;
            height: auto;
            display: block;
            margin: 20px auto;
            cursor: pointer;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
            animation: bounce 2s ease-in-out infinite;
        }

        #gift-box:hover {
            transform: scale(1.15);
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .final-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 0, 20, 0.95);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease-out;
        }

        .final-overlay.show {
            display: flex;
        }

        .final-overlay h2 {
            font-family: 'Sacramento', cursive;
            font-size: 3rem;
            color: var(--text-gold);
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        /* 
         * ========================================
         * BUTTON STYLING
         * ========================================
         */
        .btn {
            background: linear-gradient(135deg, var(--neon-pink), var(--neon-violet));
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 20, 147, 0.4), 0 0 20px rgba(157, 78, 221, 0.3);
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 1s forwards;
            font-family: 'Poppins', sans-serif;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 25px rgba(255, 20, 147, 0.6), 0 0 30px rgba(157, 78, 221, 0.5);
        }

        .btn:active {
            transform: translateY(-1px) scale(1.02);
        }



        /* 
         * ========================================
         * RESPONSIVE DESIGN
         * ========================================
         */
        @media (max-width: 600px) {
            #countdown-stage h1 {
                font-size: 1.5rem;
            }

            #countdown-timer {
                font-size: 11vw;
                /* Responsive sizing for full date string */
            }

            .countdown-label {
                font-size: 0.8rem;
            }

            #greeting-text {
                font-size: 2rem;
            }

            #greeting-stage img {
                width: 120px;
            }

            #cake-stage img {
                width: 200px;
            }

            #cake-message {
                font-size: 1.7rem;
            }

            .btn {
                padding: 12px 28px;
                font-size: 1rem;
            }

            .advance-wish {
                font-size: 18px !important;
                /* Slightly increased for better legibility */
                /* Critical: Must be small enough for 34ch to fit on 320px */
                letter-spacing: 0px;
                /* Remove spacing to save width */
                margin-top: 10px;
                -webkit-text-stroke: 0.3px black;
                width: 100%;
                /* Ensure container fit */
                display: flex;
                /* Helps with alignment in container */
                justify-content: center;
                /* Center the block itself */
            }
        }

        @media (max-width: 400px) {
            #countdown-timer {
                font-size: 10vw;
                /* Further adjustment for very small screens */
            }

            .countdown-label {
                font-size: 0.7rem;
            }



            #greeting-text {
                font-size: 1.7rem;
            }

            #cake-stage img {
                width: 180px;
            }


        }
    </style>
</head>

<body>

    <!-- ========================================
         STAGE 1: COUNTDOWN
         ======================================== -->
    <div id="countdown-stage" class="stage active">
        <audio id="countdown-audio" src="Audio/love.mpeg" loop preload="auto"></audio>
        <audio id="celebration-audio" src="Audio/Song1.mpeg" loop preload="auto"></audio>

        <h1>Counting down to your(my)Special Day...</h1>
        <div id="countdown-timer">Loading...</div>
        <div class="countdown-label">DAYS : HOURS : MINS : SECS</div>

        <div id="countdown-controls">
            <!-- Hidden initially, shown when countdown ends -->
            <button id="enter-btn" class="btn" style="display: none; margin-top: 30px;" onclick="nextStage()">Enter to
                Your 19th Year &rarr;</button>

            <!-- Advance Wish -->
            <div class="advance-wish-container">
                <div class="advance-wish">Advance Happiest Birthday Mah‚ù§Ô∏è</div>
            </div>

        </div>
    </div>

    <!-- ========================================
         STAGE 2: GREETING
         ======================================== -->
    <div id="greeting-stage" class="stage">
        <img src="images/Her.png" alt="Cute character">
        <h2 id="greeting-text"></h2>
        <p>Yes, it's YOU! A little surprise awaits...</p>
        <button class="btn" onclick="nextStage()">Start the surprise &rarr;</button>
    </div>

    <!-- ========================================
         STAGE 3: INTERACTIVE CAKE
         ======================================== -->
    <div id="cake-stage" class="stage">
        <h3 id="cake-message">Decorate the Cake</h3>

        <!-- Wrapped image for positioning -->
        <div class="cake-container" id="cake-container" style="position: relative; display: inline-block;">
            <img src="images/cake.png" alt="Birthday Cake" id="cake-img" style="display: block; margin: 0;">
        </div>

        <!-- New Decoration System -->
        <div class="party-wrapper" id="partyDecor"></div>

        <!-- Name Reveal Area -->
        <div id="name-container" class="name-reveal-container"></div>

        <div style="margin-top: 20px;">
            <button class="btn" id="cake-btn">Decorate üéâ</button>
        </div>
    </div>

    <!-- ========================================
         STAGE 5: GIFT
         ======================================== -->
    <div id="final-stage" class="stage">
        <div id="gift-section">
            <p>Tap the gift!</p>
            <img src="images/gift.png" alt="Gift Box" id="gift-box" onclick="openGift()">
        </div>
    </div>

    <!-- Final Overlay -->
    <div class="final-overlay" id="final-overlay">
        <h2>Happy Birthday! üéä</h2>
        <p style="font-size: 1.2rem; margin-bottom: 30px; color: var(--text-silver);">
            Hope you loved your surprise!
        </p>
        <button class="btn" style="opacity: 1; animation: none;" onclick="window.location.reload()">
            Replay &hearts;
        </button>
    </div>

    <script>
        /* 
         * ========================================
         * JAVASCRIPT - Stage Management & Animations
         * ========================================
         */

        // Configuration
        const GREETING_TEXT = "A Cutiepie was born today, 19 years ago!";
        const STAGES = ['countdown-stage', 'greeting-stage', 'cake-stage', 'final-stage'];
        let currentStageIndex = 0;

        /* 
         * ----------------------------------------
         * STAGE MANAGEMENT
         * ----------------------------------------
         */
        function nextStage() {
            // Stop countdown music when leaving the first stage
            if (currentStageIndex === 0) {
                const countdownAudio = document.getElementById('countdown-audio');
                if (countdownAudio) {
                    countdownAudio.pause();
                    countdownAudio.currentTime = 0;
                }

                // Start celebration music when entering stage 2
                const celebrationAudio = document.getElementById('celebration-audio');
                if (celebrationAudio) {
                    celebrationAudio.play().catch(err => console.log('Audio play failed:', err));
                }
            }
            document.getElementById(STAGES[currentStageIndex]).classList.remove('active');
            currentStageIndex++;
            if (currentStageIndex < STAGES.length) {
                document.getElementById(STAGES[currentStageIndex]).classList.add('active');
                if (currentStageIndex === 1) {
                    setTimeout(typewriterEffect, 300);
                }
            }
        }

        /* 
         * ----------------------------------------
         * STAGE 1: Countdown Timer
         * ----------------------------------------
         */
        function startCountdown() {
            const countdownElement = document.getElementById('countdown-timer');
            const enterBtn = document.getElementById('enter-btn');

            // Target Date: December 28, 2025 00:00:00
            const targetDate = new Date('December 28, 2025 00:00:00').getTime();

            const updateTimer = () => {
                const now = new Date().getTime();
                const distance = targetDate - now;

                if (distance < 0) {
                    // Countdown finished
                    countdownElement.textContent = "It's Time! üéâ";
                    const label = document.querySelector('.countdown-label');
                    if (label) label.style.display = 'none';

                    enterBtn.style.display = 'inline-block';
                    clearInterval(countdownInterval);
                    // üî¥ STOP MUSIC WHEN COUNTDOWN ENDS
                    const audio = document.getElementById('countdown-audio');
                    if (audio) {
                        audio.pause();
                        audio.currentTime = 0;
                    }
                    return;
                }

                // Calculations
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Formatting
                countdownElement.textContent =
                    `${days} : ${hours.toString().padStart(2, '0')} : ${minutes.toString().padStart(2, '0')} : ${seconds.toString().padStart(2, '0')}`;
            };

            const countdownInterval = setInterval(updateTimer, 1000);
            updateTimer(); // Initial call
        }

        /* 
         * ----------------------------------------
         * STAGE 2: Typewriter Effect
         * ----------------------------------------
         */
        function typewriterEffect() {
            const textElement = document.getElementById('greeting-text');
            textElement.textContent = '';
            let charIndex = 0;

            const typingInterval = setInterval(() => {
                if (charIndex < GREETING_TEXT.length) {
                    textElement.textContent += GREETING_TEXT.charAt(charIndex);
                    charIndex++;
                } else {
                    clearInterval(typingInterval);
                    textElement.classList.add('typing-complete');
                }
            }, 80);
        }

        /* 
         * ========================================
         * PARTY DECORATION SYSTEM
         * ========================================
         */
        let cakeStep = 1;

        // Event Listener for the button
        document.getElementById('cake-btn').addEventListener('click', handleCakeInteraction);

        function handleCakeInteraction() {
            const btn = document.getElementById('cake-btn');
            const message = document.getElementById('cake-message');
            const decorContainer = document.getElementById('partyDecor');
            const cakeContainer = document.getElementById('cake-container');

            if (cakeStep === 1) {
                // Step 1: Decorate (Bunting + Confetti)
                createBunting(decorContainer);
                blastConfetti(decorContainer);
                showGroundConfetti(decorContainer);

                message.textContent = 'Now light the candle!';
                btn.textContent = 'Light the Candle ‚Üí';
                cakeStep = 2;
            } else if (cakeStep === 2) {
                // Step 2: Light Candle
                lightCandle(cakeContainer);
                blastConfetti(decorContainer); // Small extra burst

                message.textContent = 'Blow the candle to make a wish! üå¨Ô∏è';
                btn.textContent = 'Tap to Blow üå¨Ô∏è';

                cakeStep = 3;
            } else if (cakeStep === 3) {
                // Step 3: Manual Blow
                extinguishCandle();
            } else if (cakeStep === 4) {
                // Step 4: Create Balloons
                createBalloons();
                btn.style.display = 'none';
                message.textContent = 'Pop all the balloons!';
            }
        }

        function extinguishCandle() {
            if (cakeStep !== 3) return; // Prevent double trigger

            const flame = document.querySelector('.flame');
            if (flame) {
                flame.classList.add('extinguished');
                setTimeout(() => flame.remove(), 500);
            }

            const message = document.getElementById('cake-message');
            message.textContent = 'Yay! Wish made! ‚ú®';

            const btn = document.getElementById('cake-btn');
            btn.textContent = 'Pop the Balloons ‚Üí';

            // Auto proceed to balloons after a short delay
            setTimeout(() => {
                cakeStep = 4;
                handleCakeInteraction(); // Trigger balloon stage
            }, 1000);
        }

        /* --- New Decoration System Functions --- */

        function createBunting(container) {
            const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff', '#9d4edd', '#ff6347'];
            // 4 Rows: 2 Left, 2 Right
            const configs = [
                { top: '-20px', left: '-10%', angle: '5deg' },
                { top: '20px', left: '-10%', angle: '15deg' },
                { top: '-20px', right: '-10%', angle: '-5deg', justifyContent: 'flex-end' },
                { top: '20px', right: '-10%', angle: '-15deg', justifyContent: 'flex-end' }
            ];

            configs.forEach((cfg, idx) => {
                const row = document.createElement('div');
                row.className = 'bunting-row';
                row.style.top = cfg.top;
                if (cfg.left) row.style.left = cfg.left;
                if (cfg.right) row.style.right = cfg.right;
                row.style.setProperty('--angle', cfg.angle);
                if (cfg.justifyContent) row.style.justifyContent = cfg.justifyContent;

                // Add flags
                for (let i = 0; i < 20; i++) {
                    const flag = document.createElement('div');
                    flag.className = 'bunting-flag';
                    flag.style.setProperty('--color', colors[(i + idx) % colors.length]);
                    row.appendChild(flag);
                }

                container.appendChild(row);
                // Staggered slide-in
                setTimeout(() => row.classList.add('show'), idx * 150);
            });
        }

        function blastConfetti(container) {
            const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff', '#9d4edd', '#ff6347'];
            const count = 100;

            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti falling';
                confetti.style.setProperty('--color', colors[Math.floor(Math.random() * colors.length)]);
                confetti.style.setProperty('--duration', (1.5 + Math.random() * 1.5) + 's');

                // Blast from Left or Right
                const isLeft = Math.random() > 0.5;
                const startX = isLeft ? '-50px' : '100vw';
                const startY = (Math.random() * 40) + 'vh'; // Top half

                // Mid point (arc effect)
                const midX = isLeft ? (20 + Math.random() * 30) + 'vw' : (80 - Math.random() * 30) + 'vw';
                const midY = (Math.random() * 30) + 'vh';

                // End point (bottom)
                const endX = (Math.random() * 100) + 'vw';
                const endY = '110vh';

                confetti.style.setProperty('--start-x', startX);
                confetti.style.setProperty('--start-y', startY);
                confetti.style.setProperty('--mid-x', midX);
                confetti.style.setProperty('--mid-y', midY);
                confetti.style.setProperty('--end-x', endX);
                confetti.style.setProperty('--end-y', endY);

                container.appendChild(confetti);

                // Cleanup
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function showGroundConfetti(container) {
            // Check if already exists
            if (container.querySelector('.ground-confetti')) return;

            const ground = document.createElement('div');
            ground.className = 'ground-confetti';

            // Create a "texture" of confetti using radial gradients
            const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff'];
            let gradient = [];
            for (let i = 0; i < 80; i++) {
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const color = colors[Math.floor(Math.random() * colors.length)];
                gradient.push(`radial-gradient(circle at ${x}% ${y}%, ${color} 2px, transparent 3px)`);
            }
            ground.style.backgroundImage = gradient.join(',');

            container.appendChild(ground);

            // Fade in after confetti starts falling
            setTimeout(() => ground.classList.add('show'), 1000);
        }

        function lightCandle(container) {
            const flame = document.createElement('div');
            flame.className = 'flame';
            // Position relative to the cake image container
            // The image is 250px wide. The candle tip is roughly at the top center.
            // Adjust top value based on visual inspection of the new image.
            flame.style.left = '50%';
            flame.style.top = '-15px';
            flame.style.transform = 'translateX(-50%)';
            container.appendChild(flame);
        }

        /* 
         * ----------------------------------------
         * BALLOON ANIMATION & LETTER REVEAL
         * ----------------------------------------
         */
        let balloonsPopped = 0;








        /* 
         * ----------------------------------------
         * BALLOON GAME: SEQUENTIAL & IMAGE BASED
         * ----------------------------------------
         */

        // Configuration for images - map letters to images cyclically or specifically
        // Using the images found in the directory
        const BALLOON_IMAGES = [
            'images/b1.png', 'images/b2.png', 'images/b3.png', 'images/b4.png',
            'images/b5.png', 'images/b6.png', 'images/b7.png', 'images/b8.png',
            'images/b9.png', 'images/b10.png', 'images/b11.png', 'images/b12.png', 'images/b13.png'
        ];
        /* Balloon Logic: Random Float & Pop-to-Reveal */
        let isBalloonStageActive = false; // New LOCK flag

        function createBalloons() {
            // IMMEDIATE GUARD: If already active, stop.
            if (isBalloonStageActive) return;
            isBalloonStageActive = true; // Lock immediately

            // 1. CLEANUP: Remove any existing balloons first just in case
            const existingBalloons = document.querySelectorAll('.balloon-group');
            if (existingBalloons.length > 0) {
                existingBalloons.forEach(b => b.remove());
            }

            const cakeStage = document.getElementById('cake-stage');
            const nameContainer = document.getElementById('name-container');

            // 2. HIDE CAKE & BUTTON
            // Also disable button to prevent further clicks
            const cakeBtn = document.getElementById('cake-btn');
            cakeBtn.style.display = 'none';
            cakeBtn.disabled = true;

            document.getElementById('cake-container').style.display = 'none';

            const name = "Thoongu Munchi";
            const letters = name.replace(/\s/g, '').split(''); // "ThoonguMunchi" (13 chars)
            const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff', '#9d4edd', '#ff6347', '#ff69b4', '#32cd32', '#ffa500', '#da70d6'];

            // Reset state
            currentBalloonIndex = 0;
            nameContainer.innerHTML = '';
            nameContainer.style.opacity = '1';
            balloonsPopped = 0; // Ensure counter is reset

            // Create 13 Surprise Boxes
            letters.forEach((char, index) => {
                const box = document.createElement('div');
                box.classList.add('surprise-box');
                box.id = `box-${index}`;
                box.dataset.char = char;
                nameContainer.appendChild(box);
            });

            // --- MOBILE-SAFE CENTERED DISTRIBUTION (25% to 75%) ---
            // Much tighter range to keep all balloons centered and in-frame
            const slots = [];
            const startX = 25;  // Moved from 15% to 25%
            const endX = 75;    // Moved from 85% to 75%
            // 13 points evenly spread
            const step = (endX - startX) / (letters.length - 1);

            for (let i = 0; i < letters.length; i++) {
                slots.push(startX + (i * step));
            }

            // Shuffle slots for randomness
            for (let i = slots.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [slots[i], slots[j]] = [slots[j], slots[i]];
            }

            // Spawn exactly 13 balloons
            for (let i = 0; i < letters.length; i++) {
                setTimeout(() => {
                    spawnFloatingBalloon(i, colors, cakeStage, letters.length, slots[i]);
                }, i * 300);
            }
        }

        function spawnFloatingBalloon(index, colors, container, totalCount, assignedLeft) {
            const group = document.createElement('div');
            group.classList.add('balloon-group');

            // No jitter - use exact position to prevent out-of-bounds
            const finalLeft = assignedLeft;

            // Vertical Stagger (Randomized Layers)
            // Range: 25% to 55% from bottom (Safe center band)
            // This ensures they don't hit the top or cover the boxes too much
            const baseBottom = 40;
            const bottomVariance = (Math.random() * 30) - 15;
            const finalBottom = baseBottom + bottomVariance;

            // Apply Styles
            group.style.left = `${finalLeft}%`;
            group.style.bottom = '-60vh'; // Start well below viewport

            // Visual Elements
            const balloon = document.createElement('div');
            balloon.classList.add('balloon');
            balloon.style.backgroundColor = colors[index % colors.length];
            balloon.style.borderBottomColor = colors[index % colors.length];

            const string = document.createElement('div');
            string.classList.add('balloon-string');

            const img = document.createElement('img');
            const imgPath = BALLOON_IMAGES[index % BALLOON_IMAGES.length];
            img.src = imgPath;
            img.alt = "Memory";

            group.appendChild(balloon);
            group.appendChild(string);
            group.appendChild(img);

            container.appendChild(group);

            // Force Reflow for Mobile Safari/Chrome transition
            void group.offsetWidth;

            // ANIMATION TRIGGER
            // Use requestAnimationFrame to ensure the 'bottom' transition happens
            // after the element is painted at -60vh.
            requestAnimationFrame(() => {
                group.style.bottom = `${finalBottom}%`;
            });

            // Add bobbing animation after the rise is roughly complete
            // Transition is set to 15s in CSS, so we wait slightly less to start blending
            setTimeout(() => {
                group.classList.add('floating');
            }, 14000);

            // CLICK INTERACTION
            group.onclick = function () {
                if (this.dataset.clicked === "true") return;
                this.dataset.clicked = "true";

                // Pop Animation
                balloon.classList.add('popped');
                this.classList.add('popped');

                // Reveal Letter
                const allBoxes = document.querySelectorAll('.surprise-box');
                for (let box of allBoxes) {
                    if (!box.classList.contains('revealed')) {
                        box.classList.add('revealed');
                        // Use the dataset char we stored earlier
                        box.innerHTML = `<span>${box.dataset.char}</span>`;
                        break;
                    }
                }

                balloonsPopped++;

                // Cleanup
                setTimeout(() => {
                    this.remove();
                    if (balloonsPopped === totalCount) {
                        setTimeout(finishBalloonStage, 1000);
                    }
                }, 300);
            };
        }

        function finishBalloonStage() {
            const message = document.getElementById('cake-message');
            const nameContainer = document.getElementById('name-container');

            // 1. Hide the instruction message
            message.style.opacity = '0';

            // 2. Fade out the boxes
            nameContainer.style.transition = 'opacity 1s ease';
            nameContainer.style.opacity = '0';

            setTimeout(() => {
                // 3. Clear boxes and show FINAL MESSAGE
                nameContainer.innerHTML = "Wish You Happiest Birthday My Dear Thoongu Munchi ‚ù§Ô∏è";

                // 4. Style the final message
                nameContainer.style.fontFamily = "'Sacramento', cursive";
                nameContainer.style.fontSize = "3rem";
                nameContainer.style.color = "var(--text-gold)";
                nameContainer.style.textShadow = "0 0 20px var(--neon-pink)";
                nameContainer.style.display = "block";
                nameContainer.style.textAlign = "center";
                nameContainer.style.lineHeight = "1.4";

                // 5. Fade back in
                nameContainer.style.opacity = '1';

                // Add a proceed button
                const btn = document.getElementById('cake-btn');
                btn.textContent = "Open your Gift ‚Üí";
                btn.style.display = 'inline-block';
                btn.style.marginTop = "30px";
                btn.disabled = false; // Re-enable the button
                btn.onclick = nextStage;

                // Massive Confetti 
                blastConfetti(document.getElementById('partyDecor'));

                // Extra celebration loop
                let celebrationCount = 0;
                const celebrate = setInterval(() => {
                    blastConfetti(document.getElementById('partyDecor'));
                    celebrationCount++;
                    if (celebrationCount > 3) clearInterval(celebrate);
                }, 800);

            }, 1000);
        }

        /* 
         * ----------------------------------------
         * STAGE 5: Gift
         * ----------------------------------------
         */
        function openGift() {
            // Stop celebration music when opening gift
            const celebrationAudio = document.getElementById('celebration-audio');
            if (celebrationAudio) {
                celebrationAudio.pause();
                celebrationAudio.currentTime = 0;
            }

            // Massive confetti explosion
            for (let i = 0; i < 150; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti falling');
                    const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff', '#9d4edd', '#ff6347', '#ff69b4'];
                    confetti.style.setProperty('--color', colors[Math.floor(Math.random() * colors.length)]);
                    confetti.style.setProperty('--duration', '2s');

                    const startX = Math.random() * 100 + 'vw';
                    const startY = '0px';

                    confetti.style.setProperty('--start-x', startX);
                    confetti.style.setProperty('--start-y', startY);

                    const endX = Math.random() * 100 + 'vw';
                    const endY = '100vh';

                    confetti.style.setProperty('--end-x', endX);
                    confetti.style.setProperty('--end-y', endY);

                    // Mid points not needed for simple fall
                    confetti.style.setProperty('--mid-x', startX);
                    confetti.style.setProperty('--mid-y', startY);

                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 2000);
                }, i * 10);
            }

            setTimeout(() => {
                window.location.href = 'timeline.html';
            }, 2000);
        }

        /* 
         * ----------------------------------------
         * Initialize on Page Load
         * ----------------------------------------
         */
        document.addEventListener('DOMContentLoaded', () => {
            startCountdown();
        });

        /* ========================================
         * UNIVERSAL AUDIO UNLOCK (MOBILE + DESKTOP)
         * ======================================== */
        function initAudioUnlock() {
            const audio = document.getElementById('countdown-audio');

            // Define the unlock function
            const unlock = () => {
                if (!audio) return;

                // Try to play
                audio.volume = 1.0;
                audio.muted = false;

                const playPromise = audio.play();

                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        // Success - Remove listeners
                        cleanUpListeners();
                    }).catch(error => {
                        console.log("Autoplay prevented:", error);
                        // User requested no button, so we just wait for the next interaction
                    });
                }
            };

            const cleanUpListeners = () => {
                document.removeEventListener('click', unlock);
                document.removeEventListener('touchstart', unlock);
                document.removeEventListener('scroll', unlock);
                document.removeEventListener('keydown', unlock);
            };

            // Add listeners for any interaction
            document.addEventListener('click', unlock, { once: true });
            document.addEventListener('touchstart', unlock, { once: true });
            document.addEventListener('scroll', unlock, { once: true });
            document.addEventListener('keydown', unlock, { once: true });
        }

        // Initialize immediately
        initAudioUnlock();


    </script>

</body>

</html>