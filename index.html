<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Birthday Surprise</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sacramento&family=Poppins:wght@300;400;600&display=swap"
        rel="stylesheet">

    <style>
        /* 
         * ========================================
         * COSMIC THEME - Mobile First Design
         * ========================================
         */
        :root {
            --bg-dark: #0a0014;
            --bg-violet: #1a0033;
            --neon-pink: #ff1493;
            --neon-violet: #9d4edd;
            --text-silver: #e0e0e0;
            --text-pink: #ffc0cb;
            --text-gold: #ffd700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at 50% 50%, var(--bg-violet) 0%, var(--bg-dark) 100%);
            color: var(--text-silver);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated starfield background */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent),
                radial-gradient(1px 1px at 33% 80%, white, transparent);
            background-size: 200% 200%;
            animation: twinkle 8s ease-in-out infinite;
            opacity: 0.6;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.6;
            }

            50% {
                opacity: 0.3;
            }
        }

        /* 
         * ========================================
         * STAGE CONTAINER
         * ========================================
         */
        .stage {
            display: none;
            text-align: center;
            padding: 20px;
            max-width: 90%;
            width: 600px;
            animation: fadeIn 0.8s ease-out;
            position: relative;
            z-index: 1;
        }

        .stage.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 
         * ========================================
         * STAGE 1: COUNTDOWN
         * ========================================
         */
        #countdown-stage h1 {
            font-family: 'Sacramento', cursive;
            font-size: 2rem;
            color: var(--text-pink);
            margin-bottom: 30px;
            letter-spacing: 2px;
        }

        #countdown-timer {
            font-size: 3.5rem;
            /* Reduced for full date string */
            font-weight: 700;
            color: #fff;
            display: inline-block;
            animation: pulse 1.5s ease-in-out infinite;
            text-shadow:
                0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink),
                0 0 30px var(--neon-pink), 0 0 40px var(--neon-violet),
                0 0 70px var(--neon-violet), 0 0 80px var(--neon-violet),
                0 0 100px var(--neon-violet);
            white-space: nowrap;
        }

        .countdown-label {
            display: block;
            font-size: 1rem;
            color: var(--text-gold);
            margin-top: 10px;
            letter-spacing: 2px;
        }



        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                text-shadow:
                    0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink),
                    0 0 30px var(--neon-pink), 0 0 40px var(--neon-violet),
                    0 0 70px var(--neon-violet), 0 0 80px var(--neon-violet),
                    0 0 100px var(--neon-violet);
            }

            50% {
                transform: scale(1.05);
                text-shadow:
                    0 0 15px var(--neon-violet), 0 0 25px var(--neon-violet),
                    0 0 35px var(--neon-violet), 0 0 45px var(--neon-pink),
                    0 0 75px var(--neon-pink), 0 0 85px var(--neon-pink),
                    0 0 110px var(--neon-pink);
            }
        }

        /* 
         * ========================================
         * STAGE 2: GREETING
         * ========================================
         */
        #greeting-stage img {
            width: 150px;
            height: auto;
            margin-bottom: 30px;
            animation: bounceIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 20px rgba(255, 105, 180, 0.5));
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            60% {
                transform: scale(1.15);
                opacity: 1;
            }

            100% {
                transform: scale(1);
            }
        }

        #greeting-text {
            font-family: 'Sacramento', cursive;
            font-size: 2.5rem;
            line-height: 1.4;
            color: var(--neon-pink);
            margin-bottom: 15px;
            min-height: 3.5rem;
            text-shadow: 0 0 10px rgba(255, 20, 147, 0.8), 0 0 20px rgba(255, 20, 147, 0.5);
        }

        #greeting-text::after {
            content: '|';
            animation: blink 0.8s infinite;
            margin-left: 3px;
        }

        #greeting-text.typing-complete::after {
            content: '';
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        #greeting-stage p {
            font-size: 1rem;
            color: var(--text-silver);
            margin-bottom: 30px;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 0.5s forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 
         * ========================================
         * STAGE 3: INTERACTIVE CAKE
         * ========================================
         */
        #cake-stage {
            position: relative;
        }

        #cake-stage img {
            width: 250px;
            height: auto;
            margin: 0 auto 20px auto;
            display: block;
            filter: drop-shadow(0 0 15px rgba(255, 105, 180, 0.3));
        }

        #cake-message {
            font-family: 'Sacramento', cursive;
            font-size: 2rem;
            color: var(--neon-pink);
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 20, 147, 0.6);
            min-height: 2.5rem;
        }

        /* 
         * ========================================
         * NEW PARTY DECORATION SYSTEM
         * ========================================
         */
        .party-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 99;
            overflow: hidden;
        }

        /* Bunting Flags */
        .bunting-row {
            position: absolute;
            display: flex;
            width: 150%;
            height: 60px;
            top: -100px;
            /* Start off-screen */
            transition: transform 0.8s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .bunting-row.show {
            transform: translateY(100px) rotate(var(--angle));
        }

        .bunting-flag {
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 50px solid var(--color);
            margin: 0 5px;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.1));
        }

        /* Confetti Blast */
        .confetti {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: var(--color);
            opacity: 0;
        }

        .confetti.falling {
            animation: blastFall var(--duration) ease-out forwards;
        }

        @keyframes blastFall {
            0% {
                opacity: 1;
                transform: translate(var(--start-x), var(--start-y)) rotate(0deg) scale(0.5);
            }

            20% {
                opacity: 1;
                transform: translate(var(--mid-x), var(--mid-y)) rotate(180deg) scale(1.2);
            }

            100% {
                opacity: 0;
                transform: translate(var(--end-x), var(--end-y)) rotate(720deg) scale(1);
            }
        }

        /* Ground Confetti Layer */
        .ground-confetti {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            opacity: 0;
            transition: opacity 1.5s ease-in;
            z-index: 1;
            background-repeat: repeat-x;
            background-position: bottom;
        }

        .ground-confetti.show {
            opacity: 1;
        }

        /* Realistic Flame */
        .flame {
            position: absolute;
            width: 20px;
            height: 30px;
            background: radial-gradient(ellipse at bottom, #fff 0%, #ffeb3b 40%, #ff9800 100%);
            border-radius: 50% 50% 20% 20%;
            transform-origin: center bottom;
            animation: flicker 0.1s infinite alternate, glow 1.5s ease-in-out infinite alternate;
            box-shadow:
                0 0 20px #ffeb3b,
                0 0 40px #ff9800,
                0 0 60px #ff5722;
            z-index: 5;
            filter: blur(1px);
        }

        @keyframes flicker {
            0% {
                transform: translateX(-50%) scale(1) rotate(-2deg);
                opacity: 0.9;
            }

            100% {
                transform: translateX(-50%) scale(1.1) rotate(2deg);
                opacity: 1;
            }
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 20px #ffeb3b, 0 0 40px #ff9800;
            }

            100% {
                box-shadow: 0 0 30px #ffeb3b, 0 0 60px #ff9800, 0 0 80px #ff5722;
            }
        }

        .flame.extinguished {
            animation: extinguish 0.5s ease-out forwards;
        }

        @keyframes extinguish {
            0% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateX(-50%) scale(0.2) translateY(-20px);
                opacity: 0;
            }
        }

        /* Balloon Animation */
        .balloon {
            position: absolute;
            width: 60px;
            height: 80px;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            opacity: 0;
            animation: floatIn 1s ease-out forwards, floatHover 3s ease-in-out infinite alternate;
            cursor: pointer;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            user-select: none;
            z-index: 20;
        }

        .balloon::before {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
        }

        .balloon::after {
            content: '‚ñº';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
        }

        .balloon.popped {
            animation: pop 0.3s ease-out forwards;
        }

        @keyframes floatIn {
            from {
                transform: translateY(100vh) scale(0.5);
                opacity: 0;
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes floatHover {
            0% {
                transform: translateY(0) rotate(-5deg);
            }

            100% {
                transform: translateY(-20px) rotate(5deg);
            }
        }

        @keyframes pop {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.4);
                opacity: 0.8;
            }

            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        /* Name Reveal Container */
        .name-reveal-container {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 30px;
            flex-wrap: wrap;
            min-height: 60px;
            max-width: 100%;
            padding: 0 10px;
        }

        .surprise-box {
            width: 28px;
            height: 38px;
            border: 2px solid var(--neon-violet);
            border-radius: 6px;
            background: rgba(26, 0, 51, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.2rem;
            color: var(--text-gold);
            text-shadow: 0 0 5px var(--neon-pink);
            box-shadow: 0 0 10px rgba(157, 78, 221, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .surprise-box.revealed {
            background: var(--neon-pink);
            color: white;
            border-color: white;
            transform: scale(1.1);
            box-shadow: 0 0 20px var(--neon-pink);
        }

        /* Animation for letter appearing */
        .surprise-box span {
            display: inline-block;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            70% {
                transform: scale(1.4);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* 
         * ========================================
         * STAGE 5: MESSAGE & GIFT
         * ========================================
         */
        .message-card {
            width: 100%;
            max-width: 400px;
            height: 300px;
            margin: 0 auto 20px;
            perspective: 1000px;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .message-card.opened .card-inner {
            transform: rotateY(180deg);
        }

        .card-front,
        .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .card-front {
            background: linear-gradient(135deg, var(--neon-pink), var(--neon-violet));
            color: white;
            font-family: 'Sacramento', cursive;
            font-size: 2.5rem;
        }

        .card-back {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: var(--text-silver);
            transform: rotateY(180deg);
            font-size: 1rem;
            line-height: 1.6;
            overflow-y: auto;
        }

        #message-next-btn {
            display: none;
        }

        #gift-section {
            text-align: center;
        }

        #gift-section p {
            font-size: 1.2rem;
            color: var(--text-pink);
            margin-bottom: 20px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        #gift-box {
            width: 200px;
            height: auto;
            display: block;
            margin: 20px auto;
            cursor: pointer;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
            animation: bounce 2s ease-in-out infinite;
        }

        #gift-box:hover {
            transform: scale(1.15);
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .final-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 0, 20, 0.95);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease-out;
        }

        .final-overlay.show {
            display: flex;
        }

        .final-overlay h2 {
            font-family: 'Sacramento', cursive;
            font-size: 3rem;
            color: var(--text-gold);
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        /* 
         * ========================================
         * BUTTON STYLING
         * ========================================
         */
        .btn {
            background: linear-gradient(135deg, var(--neon-pink), var(--neon-violet));
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 20, 147, 0.4), 0 0 20px rgba(157, 78, 221, 0.3);
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeInUp 0.8s ease-out 1s forwards;
            font-family: 'Poppins', sans-serif;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 25px rgba(255, 20, 147, 0.6), 0 0 30px rgba(157, 78, 221, 0.5);
        }

        .btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        /* 
         * ========================================
         * GLITCH TYPEWRITER EFFECT
         * ========================================
         */
        .glitch-wrapper {
            margin-top: 40px;
            opacity: 0;
            animation: fadeIn 1s ease-out 2s forwards;
            /* 2s delay for "slowly" */
            min-height: 40px;
            display: flex;
            justify-content: center;
        }

        .glitch-text {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            position: relative;
            display: inline-block;
            letter-spacing: 2px;
            text-shadow:
                0 0 5px var(--neon-pink),
                0 0 10px var(--neon-pink),
                0 0 20px var(--neon-pink),
                0 0 40px var(--neon-violet),
                0 0 80px var(--neon-violet);
        }

        /* Typewriter Animation */
        .glitch-text::before {
            content: "Advance Happie Birthday Mah....! ‚ù§Ô∏è";
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            overflow: hidden;
            border-right: 2px solid var(--neon-violet);
            color: #fff;
            text-shadow:
                0 0 5px var(--neon-pink),
                0 0 10px var(--neon-pink),
                0 0 20px var(--neon-pink),
                0 0 40px var(--neon-violet),
                0 0 80px var(--neon-violet);
            animation: typing 3s steps(30, end) 2.5s forwards, blinkCursor 0.75s step-end infinite;
            white-space: nowrap;
        }

        /* Glitch Animation Layer */
        .glitch-text::after {
            content: "Advance Happie Birthday Mah....! ‚ù§Ô∏è";
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            overflow: hidden;
            color: #fff;
            opacity: 0.8;
            animation: typing 3s steps(30, end) 2.5s forwards, glitch 1s infinite alternate-reverse;
            text-shadow: -2px 0 red, 2px 0 blue;
            clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
            background: transparent;
            white-space: nowrap;
        }

        /* Ensure the base text is hidden (hack to maintain layout width) */
        .glitch-text span {
            visibility: hidden;
        }

        @keyframes typing {
            from {
                width: 0
            }

            to {
                width: 100%
            }
        }

        @keyframes blinkCursor {

            from,
            to {
                border-color: transparent
            }

            50% {
                border-color: var(--neon-violet)
            }
        }

        @keyframes glitch {
            0% {
                clip-path: polygon(0 2%, 100% 2%, 100% 5%, 0 5%);
                transform: translate(2px, 0);
            }

            20% {
                clip-path: polygon(0 15%, 100% 15%, 100% 15%, 0 15%);
                transform: translate(-2px, 0);
            }

            40% {
                clip-path: polygon(0 10%, 100% 10%, 100% 20%, 0 20%);
                transform: translate(2px, 0);
            }

            60% {
                clip-path: polygon(0 1%, 100% 1%, 100% 2%, 0 2%);
                transform: translate(-2px, 0);
            }

            80% {
                clip-path: polygon(0 33%, 100% 33%, 100% 33%, 0 33%);
                transform: translate(10px, -5px);
            }

            100% {
                clip-path: polygon(0 44%, 100% 44%, 100% 44%, 0 44%);
                transform: translate(-2px, 0);
            }
        }

        /* 
         * ========================================
         * RESPONSIVE DESIGN
         * ========================================
         */
        @media (max-width: 600px) {
            #countdown-stage h1 {
                font-size: 1.5rem;
            }

            #countdown-timer {
                font-size: 2rem;
                /* Adjusted for full date string */
            }

            .countdown-label {
                font-size: 0.8rem;
            }

            .glitch-text {
                font-size: 1rem;
            }

            #greeting-text {
                font-size: 2rem;
            }

            #greeting-stage img {
                width: 120px;
            }

            #cake-stage img {
                width: 200px;
            }

            #cake-message {
                font-size: 1.7rem;
            }

            .card-stack {
                width: 240px;
                height: 300px;
            }

            .btn {
                padding: 12px 28px;
                font-size: 1rem;
            }

            .card-front {
                font-size: 2rem;
            }

            .card-back {
                font-size: 0.9rem;
            }
        }

        @media (max-width: 400px) {
            #countdown-timer {
                font-size: 1.5rem;
                /* Further reduced for small screens */
            }

            .countdown-label {
                font-size: 0.7rem;
            }


            #greeting-text {
                font-size: 1.7rem;
            }

            #cake-stage img {
                width: 180px;
            }

            .card-stack {
                width: 200px;
                height: 260px;
            }
        }
    </style>
</head>

<body>

    <!-- ========================================
         STAGE 1: COUNTDOWN
         ======================================== -->
    <div id="countdown-stage" class="stage active">
        <audio id="countdown-audio" src="Audio/love.mp3" loop preload="auto"></audio>
        <button id="music-toggle" class="btn"
            style="display: none; position: absolute; top: 10px; right: 10px; z-index: 100; padding: 10px 20px; font-size: 0.9rem;"
            onclick="toggleMusic()">üéµ Play Music</button>
        <h1>Counting down to your(my)Special Day...</h1>
        <div id="countdown-timer">Loading...</div>
        <div class="countdown-label">DAYS : HOURS : MINS : SECS</div>

        <div id="countdown-controls">
            <!-- Hidden initially, shown when countdown ends -->
            <button id="enter-btn" class="btn" style="display: none; margin-top: 30px;" onclick="nextStage()">Enter to
                Your 19th Year &rarr;</button>

            <!-- Glitch Text Section -->
            <div class="glitch-wrapper">
                <div class="glitch-text">
                    <!-- Invisible spacer -->
                    <span>Advance Happiest Birthday Mah....! ‚ù§Ô∏è</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================
         STAGE 2: GREETING
         ======================================== -->
    <div id="greeting-stage" class="stage">
        <img src="images/Her.png" alt="Cute character">
        <h2 id="greeting-text"></h2>
        <p>Yes, it's YOU! A little surprise awaits...</p>
        <button class="btn" onclick="nextStage()">Start the surprise &rarr;</button>
    </div>

    <!-- ========================================
         STAGE 3: INTERACTIVE CAKE
         ======================================== -->
    <div id="cake-stage" class="stage">
        <h3 id="cake-message">Decorate the Cake</h3>

        <!-- Wrapped image for positioning -->
        <div class="cake-container" id="cake-container" style="position: relative; display: inline-block;">
            <img src="images/cake.png" alt="Birthday Cake" id="cake-img" style="display: block; margin: 0;">
        </div>

        <!-- New Decoration System -->
        <div class="party-wrapper" id="partyDecor"></div>

        <!-- Name Reveal Area -->
        <div id="name-container" class="name-reveal-container"></div>

        <div style="margin-top: 20px;">
            <button class="btn" id="cake-btn">Decorate üéâ</button>
        </div>
    </div>

    <!-- ========================================
         STAGE 5: MESSAGE & GIFT
         ======================================== -->
    <div id="final-stage" class="stage">
        <div class="message-card" id="message-card" onclick="openCard()">
            <div class="card-inner">
                <div class="card-front">
                    Tap to Open
                </div>
                <div class="card-back">
                    <p>
                        Happy Birthday, my dearest! üéâ<br><br>
                        On this special day, I want you to know how much you mean to me.
                        Your smile lights up my world, and your kindness inspires me every day.
                        May this year bring you endless joy, amazing adventures, and all the
                        love you deserve. Here's to another year of wonderful memories together!
                        <br><br>
                        With all my love,<br>
                        Always ‚ù§Ô∏è
                    </p>
                </div>
            </div>
        </div>
        <button class="btn" id="message-next-btn" onclick="showGift()">Next &rarr;</button>

        <div id="gift-section" style="display: none;">
            <p>Tap the gift!</p>
            <img src="images/gift.png" alt="Gift Box" id="gift-box" onclick="openGift()">
        </div>
    </div>

    <!-- Final Overlay -->
    <div class="final-overlay" id="final-overlay">
        <h2>Happy Birthday! üéä</h2>
        <p style="font-size: 1.2rem; margin-bottom: 30px; color: var(--text-silver);">
            Hope you loved your surprise!
        </p>
        <button class="btn" style="opacity: 1; animation: none;" onclick="window.location.reload()">
            Replay &hearts;
        </button>
    </div>

    <script>
        /* 
         * ========================================
         * JAVASCRIPT - Stage Management & Animations
         * ========================================
         */

        // Configuration
        const GREETING_TEXT = "A Cutiepie was born today, 19 years ago!";
        const STAGES = ['countdown-stage', 'greeting-stage', 'cake-stage', 'final-stage'];
        let currentStageIndex = 0;

        /* 
         * ----------------------------------------
         * STAGE MANAGEMENT
         * ----------------------------------------
         */
        function nextStage() {
            // Stop countdown music when leaving the first stage
            if (currentStageIndex === 0) {
                const audio = document.getElementById('countdown-audio');
                if (audio) {
                    audio.pause();
                    audio.currentTime = 0;
                }
            }
            document.getElementById(STAGES[currentStageIndex]).classList.remove('active');
            currentStageIndex++;
            if (currentStageIndex < STAGES.length) {
                document.getElementById(STAGES[currentStageIndex]).classList.add('active');
                if (currentStageIndex === 1) {
                    setTimeout(typewriterEffect, 300);
                }
            }
        }

        /* 
         * ----------------------------------------
         * STAGE 1: Countdown Timer
         * ----------------------------------------
         */
        function startCountdown() {
            const countdownElement = document.getElementById('countdown-timer');
            const enterBtn = document.getElementById('enter-btn');

            // Target Date: December 28, 2025 00:00:00
            const targetDate = new Date('December 28, 2025 00:00:00').getTime();

            const updateTimer = () => {
                const now = new Date().getTime();
                const distance = targetDate - now;

                if (distance < 0) {
                    // Countdown finished
                    countdownElement.textContent = "It's Time! üéâ";
                    const label = document.querySelector('.countdown-label');
                    if (label) label.style.display = 'none';

                    enterBtn.style.display = 'inline-block';
                    clearInterval(countdownInterval);
                    return;
                }

                // Calculations
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Formatting
                countdownElement.textContent =
                    `${days} : ${hours.toString().padStart(2, '0')} : ${minutes.toString().padStart(2, '0')} : ${seconds.toString().padStart(2, '0')}`;
            };

            const countdownInterval = setInterval(updateTimer, 1000);
            updateTimer(); // Initial call
        }

        /* 
         * ----------------------------------------
         * STAGE 2: Typewriter Effect
         * ----------------------------------------
         */
        function typewriterEffect() {
            const textElement = document.getElementById('greeting-text');
            textElement.textContent = '';
            let charIndex = 0;

            const typingInterval = setInterval(() => {
                if (charIndex < GREETING_TEXT.length) {
                    textElement.textContent += GREETING_TEXT.charAt(charIndex);
                    charIndex++;
                } else {
                    clearInterval(typingInterval);
                    textElement.classList.add('typing-complete');
                }
            }, 80);
        }

        /* 
         * ========================================
         * PARTY DECORATION SYSTEM
         * ========================================
         */
        let cakeStep = 1;

        // Event Listener for the button
        document.getElementById('cake-btn').addEventListener('click', handleCakeInteraction);

        function handleCakeInteraction() {
            const btn = document.getElementById('cake-btn');
            const message = document.getElementById('cake-message');
            const decorContainer = document.getElementById('partyDecor');
            const cakeContainer = document.getElementById('cake-container');

            if (cakeStep === 1) {
                // Step 1: Decorate (Bunting + Confetti)
                createBunting(decorContainer);
                blastConfetti(decorContainer);
                showGroundConfetti(decorContainer);

                message.textContent = 'Now light the candle!';
                btn.textContent = 'Light the Candle ‚Üí';
                cakeStep = 2;
            } else if (cakeStep === 2) {
                // Step 2: Light Candle
                lightCandle(cakeContainer);
                blastConfetti(decorContainer); // Small extra burst

                message.textContent = 'Blow the candle to make a wish! üå¨Ô∏è';
                btn.textContent = 'Tap to Blow üå¨Ô∏è';

                cakeStep = 3;
            } else if (cakeStep === 3) {
                // Step 3: Manual Blow
                extinguishCandle();
            } else if (cakeStep === 4) {
                // Step 4: Create Balloons
                createBalloons();
                btn.style.display = 'none';
                message.textContent = 'Pop all the balloons!';
            }
        }

        function extinguishCandle() {
            if (cakeStep !== 3) return; // Prevent double trigger

            const flame = document.querySelector('.flame');
            if (flame) {
                flame.classList.add('extinguished');
                setTimeout(() => flame.remove(), 500);
            }

            const message = document.getElementById('cake-message');
            message.textContent = 'Yay! Wish made! ‚ú®';

            const btn = document.getElementById('cake-btn');
            btn.textContent = 'Pop the Balloons ‚Üí';

            // Auto proceed to balloons after a short delay
            setTimeout(() => {
                cakeStep = 4;
                handleCakeInteraction(); // Trigger balloon stage
            }, 1000);
        }

        /* --- New Decoration System Functions --- */

        function createBunting(container) {
            const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff', '#9d4edd', '#ff6347'];
            // 4 Rows: 2 Left, 2 Right
            const configs = [
                { top: '-20px', left: '-10%', angle: '5deg' },
                { top: '20px', left: '-10%', angle: '15deg' },
                { top: '-20px', right: '-10%', angle: '-5deg', justifyContent: 'flex-end' },
                { top: '20px', right: '-10%', angle: '-15deg', justifyContent: 'flex-end' }
            ];

            configs.forEach((cfg, idx) => {
                const row = document.createElement('div');
                row.className = 'bunting-row';
                row.style.top = cfg.top;
                if (cfg.left) row.style.left = cfg.left;
                if (cfg.right) row.style.right = cfg.right;
                row.style.setProperty('--angle', cfg.angle);
                if (cfg.justifyContent) row.style.justifyContent = cfg.justifyContent;

                // Add flags
                for (let i = 0; i < 20; i++) {
                    const flag = document.createElement('div');
                    flag.className = 'bunting-flag';
                    flag.style.setProperty('--color', colors[(i + idx) % colors.length]);
                    row.appendChild(flag);
                }

                container.appendChild(row);
                // Staggered slide-in
                setTimeout(() => row.classList.add('show'), idx * 150);
            });
        }

        function blastConfetti(container) {
            const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff', '#9d4edd', '#ff6347'];
            const count = 100;

            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti falling';
                confetti.style.setProperty('--color', colors[Math.floor(Math.random() * colors.length)]);
                confetti.style.setProperty('--duration', (1.5 + Math.random() * 1.5) + 's');

                // Blast from Left or Right
                const isLeft = Math.random() > 0.5;
                const startX = isLeft ? '-50px' : '100vw';
                const startY = (Math.random() * 40) + 'vh'; // Top half

                // Mid point (arc effect)
                const midX = isLeft ? (20 + Math.random() * 30) + 'vw' : (80 - Math.random() * 30) + 'vw';
                const midY = (Math.random() * 30) + 'vh';

                // End point (bottom)
                const endX = (Math.random() * 100) + 'vw';
                const endY = '110vh';

                confetti.style.setProperty('--start-x', startX);
                confetti.style.setProperty('--start-y', startY);
                confetti.style.setProperty('--mid-x', midX);
                confetti.style.setProperty('--mid-y', midY);
                confetti.style.setProperty('--end-x', endX);
                confetti.style.setProperty('--end-y', endY);

                container.appendChild(confetti);

                // Cleanup
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function showGroundConfetti(container) {
            // Check if already exists
            if (container.querySelector('.ground-confetti')) return;

            const ground = document.createElement('div');
            ground.className = 'ground-confetti';

            // Create a "texture" of confetti using radial gradients
            const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff'];
            let gradient = [];
            for (let i = 0; i < 80; i++) {
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const color = colors[Math.floor(Math.random() * colors.length)];
                gradient.push(`radial-gradient(circle at ${x}% ${y}%, ${color} 2px, transparent 3px)`);
            }
            ground.style.backgroundImage = gradient.join(',');

            container.appendChild(ground);

            // Fade in after confetti starts falling
            setTimeout(() => ground.classList.add('show'), 1000);
        }

        function lightCandle(container) {
            const flame = document.createElement('div');
            flame.className = 'flame';
            // Position relative to the cake image container
            // The image is 250px wide. The candle tip is roughly at the top center.
            // Adjust top value based on visual inspection of the new image.
            flame.style.left = '50%';
            flame.style.top = '-15px';
            flame.style.transform = 'translateX(-50%)';
            container.appendChild(flame);
        }

        /* 
         * ----------------------------------------
         * BALLOON ANIMATION & LETTER REVEAL
         * ----------------------------------------
         */
        let balloonsPopped = 0;

        function createBalloons() {
            const name = "Thoongu Munchi";
            const letters = name.replace(/\s/g, '').split(''); // "ThoonguMunchi" (13 chars)
            const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff', '#9d4edd', '#ff6347', '#ff69b4', '#32cd32', '#ffa500', '#da70d6'];
            const cakeStage = document.getElementById('cake-stage');
            const nameContainer = document.getElementById('name-container');

            // Clear container
            nameContainer.innerHTML = '';
            nameContainer.style.opacity = '1';

            // Create 13 Surprise Boxes
            letters.forEach((char, index) => {
                const box = document.createElement('div');
                box.classList.add('surprise-box');
                box.id = `box-${index}`;
                // Initially empty
                nameContainer.appendChild(box);
            });

            // Create 13 Balloons
            letters.forEach((char, i) => {
                setTimeout(() => {
                    const balloon = document.createElement('div');
                    balloon.classList.add('balloon');
                    balloon.dataset.letter = char;
                    balloon.dataset.index = i; // Map to specific box
                    balloon.style.backgroundColor = colors[i % colors.length];

                    const leftPos = 10 + Math.random() * 80;
                    const topPos = 10 + Math.random() * 40;

                    balloon.style.left = `${leftPos}%`;
                    balloon.style.top = `${topPos}%`;
                    balloon.style.animationDelay = `${Math.random() * 0.5}s`;

                    balloon.onclick = function () {
                        if (!this.classList.contains('popped')) {
                            this.classList.add('popped');

                            // Reveal the specific box
                            const targetBox = document.getElementById(`box-${this.dataset.index}`);
                            if (targetBox) {
                                targetBox.classList.add('revealed');
                                targetBox.innerHTML = `<span>${this.dataset.letter}</span>`;
                            }

                            balloonsPopped++;

                            if (balloonsPopped === letters.length) {
                                setTimeout(() => {
                                    finishBalloonStage();
                                }, 1000);
                            }
                        }
                    };

                    cakeStage.appendChild(balloon);
                }, i * 150);
            });
        }

        function finishBalloonStage() {
            const message = document.getElementById('cake-message');
            const nameContainer = document.getElementById('name-container');

            // 1. Hide the instruction message
            message.style.opacity = '0';

            // 2. Fade out the boxes
            nameContainer.style.transition = 'opacity 1s ease';
            nameContainer.style.opacity = '0';

            setTimeout(() => {
                // 3. Clear boxes and show wish
                nameContainer.innerHTML = "Happy Birthday My Dear Thoongu Munchi!‚ù§Ô∏è";

                // 4. Style the wish
                nameContainer.style.fontFamily = "'Sacramento', cursive";
                nameContainer.style.fontSize = "3rem";
                nameContainer.style.color = "var(--text-gold)";
                nameContainer.style.textShadow = "0 0 20px var(--neon-pink)";
                nameContainer.style.display = "block"; // Ensure block display for text
                nameContainer.style.textAlign = "center";

                // 5. Fade back in
                nameContainer.style.opacity = '1';

                // Add a proceed button
                const btn = document.getElementById('cake-btn');
                btn.textContent = "Read My Letter ‚Üí";
                btn.style.display = 'inline-block';
                btn.onclick = nextStage;

                // Confetti celebration
                blastConfetti(document.getElementById('partyDecor'));
            }, 1000);
        }

        /* 
         * ----------------------------------------
         * STAGE 5: Message Card & Gift
         * ----------------------------------------
         */
        function openCard() {
            const card = document.getElementById('message-card');
            if (!card.classList.contains('opened')) {
                card.classList.add('opened');
                card.onclick = null;
                setTimeout(() => {
                    document.getElementById('message-next-btn').style.display = 'inline-block';
                }, 1000);
            }
        }

        function showGift() {
            document.querySelector('.message-card').style.display = 'none';
            document.getElementById('message-next-btn').style.display = 'none';
            document.getElementById('gift-section').style.display = 'block';
        }

        function openGift() {
            // Massive confetti explosion
            for (let i = 0; i < 150; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti falling');
                    const colors = ['#ff1493', '#ffd700', '#00ff00', '#00bfff', '#9d4edd', '#ff6347', '#ff69b4'];
                    confetti.style.setProperty('--color', colors[Math.floor(Math.random() * colors.length)]);
                    confetti.style.setProperty('--duration', '2s');

                    const startX = Math.random() * 100 + 'vw';
                    const startY = '0px';

                    confetti.style.setProperty('--start-x', startX);
                    confetti.style.setProperty('--start-y', startY);

                    const endX = Math.random() * 100 + 'vw';
                    const endY = '100vh';

                    confetti.style.setProperty('--end-x', endX);
                    confetti.style.setProperty('--end-y', endY);

                    // Mid points not needed for simple fall
                    confetti.style.setProperty('--mid-x', startX);
                    confetti.style.setProperty('--mid-y', startY);

                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 2000);
                }, i * 10);
            }

            setTimeout(() => {
                window.location.href = 'timeline.html';
            }, 2000);
        }

        /* 
         * ----------------------------------------
         * Initialize on Page Load
         * ----------------------------------------
         */
        document.addEventListener('DOMContentLoaded', () => {
            const audio = document.getElementById('countdown-audio');
            const musicBtn = document.getElementById('music-toggle');

            if (audio) {
                audio.volume = 1.0;
                const playPromise = audio.play();

                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log("Autoplay prevented:", error);
                        // Show the play button
                        if (musicBtn) {
                            musicBtn.style.display = 'block';
                            musicBtn.style.animation = 'pulse 1.5s infinite';
                        }
                    });
                }
            }
            startCountdown();
        });

        function toggleMusic() {
            const audio = document.getElementById('countdown-audio');
            const musicBtn = document.getElementById('music-toggle');
            if (audio.paused) {
                audio.play();
                musicBtn.textContent = "üîá Stop Music";
                musicBtn.style.animation = 'none'; // Stop pulsing once clicked
            } else {
                audio.pause();
                musicBtn.textContent = "üéµ Play Music";
            }
        }
    </script>

</body>

</html>